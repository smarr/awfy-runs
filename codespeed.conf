# -*- mode: yaml -*-
# Config file for ReBench
standard_experiment: all
standard_data_file: 'benchmark.data'

statistics:
    confidence_level: 0.95

runs:
    number_of_data_points: 10

quick_runs:
    number_of_data_points: 3
    max_time: 60   # time in seconds

are_we_fast_yet:
    ## this is ignored by rebench
    iteration_numbers:
        fast_vm:      &FAST_VM      1000
        slow_vm:      &SLOW_VM      250
        slower_vm:    &SLOWER_VM    85
        very_slow_vm: &VERY_SLOW_VM 25

# definition of benchmark suites
benchmark_suites:
    fj-java:
        gauge_adapter: RebenchLog
        command: " -cp ../benchmarks/Java/benchmarks.jar Harness %(benchmark)s%(cores)s %(variable)s "
        variable_values: *FAST_VM ## the number iterations measured
        max_runtime: 1800
        # location: awfy/benchmarks/SOM
        cores:
          - Nai # fork all tasks, only do a join locally
          - One # only one parallel task by forking and immediately joining
          - Opt # fork, but do one task locally
          - Seq # all fork() are compute()
        benchmarks: &BENCHMARKS
            - CilkSort:
                extra_args: 1
            - FFT:
                extra_args: 1014
            - Fib:
                extra_args: 14
            - Integrate:
                extra_args: 5000 # 10000
            - Jacobi:
                extra_args: 1024
            - LUDecomposition:
                extra_args: 1024
            - NQueens:
                extra_args: 15
            - QuickSort:
                extra_args: 100000
            - Permute:
                extra_args: 1000
                codespeed_name: "[peak] Permute"
            - UTS:
                extra_args: 1 #2, 3, 4, 5, 6

    steady-som-interp:
        gauge_adapter: RebenchLog
        command: " -cp .:Core:CD:DeltaBlue:Havlak:Json:NBody:Richards:../../implementations/TruffleSOM/Smalltalk Harness.som  %(benchmark)s %(variable)s "
        max_runtime: 3600
        variable_values: *VERY_SLOW_VM ## the number iterations measured
        location: awfy/benchmarks/SOM
        benchmarks: *BENCHMARKS

    steady-som-slower:
        gauge_adapter: RebenchLog
        command: " -cp .:Core:CD:DeltaBlue:Havlak:Json:NBody:Richards:../../implementations/TruffleSOM/Smalltalk Harness.som  %(benchmark)s %(variable)s "
        max_runtime: 3600
        variable_values: *SLOWER_VM
        location: awfy/benchmarks/SOM
        benchmarks: *BENCHMARKS

    steady-somns:
        gauge_adapter: RebenchLog
        command: " Harness.som %(benchmark)s %(variable)s "
        location: awfy/benchmarks/SOMns
        variable_values: *FAST_VM ## the number iterations measured
        max_runtime: 1800
        benchmarks: *BENCHMARKS

    interp-somns:
        gauge_adapter: RebenchLog
        command: " Harness.som %(benchmark)s %(variable)s "
        location: awfy/benchmarks/SOMns
        variable_values: *VERY_SLOW_VM ## the number iterations measured
        max_runtime: 1800
        benchmarks: *BENCHMARKS

    interp-java:
        gauge_adapter: RebenchLog
        command: " -cp ../benchmarks/Java/benchmarks.jar Harness %(benchmark)s %(variable)s "
        variable_values: *VERY_SLOW_VM ## the number iterations measured
        max_runtime: 1800
        benchmarks: *BENCHMARKS

# VMs have a name and are specified by a path and the binary to be executed
virtual_machines:
    # JVMs
    Java8U66:
        path: awfy/implementations/
        binary: java8.sh
        build: ./build-java.sh

    SOMns:
        path: awfy/implementations/
        binary: SOMns.sh
        build:
          - ./build-graal.sh
          - ./build-somns.sh
    SOMnsInt:
        path: awfy/implementations/
        binary: SOMns.sh
        args: " -G "
        build: ./build-somns.sh
    SOMns-Enterprise:
        path: awfy/implementations/
        binary: SOMns-e.sh
        build: ./build-somns.sh

experiments:
    fj-java:
        description: Measure steady state performance
        benchmark: fj-java
        executions:
            # - GraalC2
            # - GraalBasic
            # - GraalEnterprise
            - Java8U66

    steady-som:
        executions:
            - SOMns:
                benchmark: steady-somns
            - SOMns-Enterprise:
                benchmark: steady-somns
